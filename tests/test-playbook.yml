---
# Develmicro tests, from root folder run: ./testme.sh.

- name: Apply microcontroller developer configuration.
  hosts: localhost
  connection: local
  gather_facts: false

  tasks:
  - name: Test with non-empty user mary.
    debug:
      msg:
        - '__________________________________________________________________'
        - 'Testing with non-empty user mary ...'
        - '        __....._'
        - '     .`` _  o    ``'
        - '   ." O (_)     () o`'
        - '  .           O        '
        - ' . ()   o__...__    O   '
        - '. _.--```       ```--._ '
        - ':`                     `'
        - ' `-.__    :    :   __.-`'
        - '      ```-:    :-```'
        - '         J     '
        - '         :     '
        - '        J       '
        - '        :       '
        - '        `._____.'
        - '__________________________________________________________________'

  - name: Apply configuration using user mary.
    include_role:
      name: constrict0r.develmicro
    vars:
      users: [mary]

  - name: Verify curl installed.
    file:
      path: /usr/bin/curl

  - name: Verify emacs installed.
    file:
      path: /usr/bin/emacs

  - name: Verify platformio installed.
    command: python3 -m pip list --format=columns | grep platformio
    register: platformio_result
    become: true
    failed_when: platformio_result.stdout is not search('platformio') 

  - name: Verify emacs main configuration file created for mary.
    file:
      path: /home/mary/.emacs.d/init.el
    become: true

  - name: Verify emacs micro configuration file created for user mary.
    file:
      path: /home/mary/.emacs.d/config/micro.el
    become: true

  - name: Verify emacs theme downloaded for mary.
    file:
      path:  /home/mary/.emacs.d/themes/wintermute-theme.el
